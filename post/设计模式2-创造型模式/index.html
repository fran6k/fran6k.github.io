<!DOCTYPE html>
<html
  dir="ltr"
  lang="zh-cn"
  data-theme=""
  
    class="html theme--light"
  
><head>
  <title>
    fran6k&#39;s blog
        |
        设计模式2-创造型模式及应用
      

    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.111.3"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="fran6k&#39;s blog" />
  <meta
    name="description"
    content="学生｜后端｜云原生
在这里分享一些技术沉淀
"
  />
  
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.853b40b40e3fdc2dc45fd58ccdf26cd746d2309db1b3f58856564adfb34ecae5.css"
      integrity="sha256-hTtAtA4/3C3EX9WMzfJs10bSMJ2xs/WIVlZK37NOyuU="
      crossorigin="anonymous"
      type="text/css"
    />
  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.2d1384e713286a803f77dd52bedaf63bc9a1428da2f19b58559e17412f43bdac.css"
    integrity="sha256-LROE5xMoaoA/d91Svtr2O8mhQo2i8ZtYVZ4XQS9Dvaw="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/css/syntax.min.7ac04f67eca661571e942c0456c2b00f691243597031edab6852106211ba1dd2.css"
      integrity="sha256-esBPZ&#43;ymYVcelCwEVsKwD2kSQ1lwMe2raFIQYhG6HdI="
      crossorigin="anonymous"
      media="screen"
    />
  
    
    
    <link
      rel="stylesheet"
      href="/css/font.min.c452ee21b0b6ea266bb9ade155d178350f351bf4e85a00363a3c30a1aeae6b07.css"
      integrity="sha256-xFLuIbC26iZrua3hVdF4NQ81G/ToWgA2Ojwwoa6uawc="
      crossorigin="anonymous"
      media="screen"
    />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css"
    integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css"
    integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css"
    integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css"
    integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />

  <link rel="canonical" href="https://fran6k.live/post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%88%9B%E9%80%A0%E5%9E%8B%E6%A8%A1%E5%BC%8F/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.ec8addde0700c05e25920a03b8118ffc37f3532a355915aa087628fe3a421b2e.js"
    integrity="sha256-7Ird3gcAwF4lkgoDuBGP/DfzUyo1WRWqCHYo/jpCGy4="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js"
      integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc="
      crossorigin="anonymous"
    ></script>
  

  


  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="设计模式2-创造型模式及应用"/>
<meta name="twitter:description" content=""/>



  
  <meta property="og:title" content="设计模式2-创造型模式及应用" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fran6k.live/post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%88%9B%E9%80%A0%E5%9E%8B%E6%A8%A1%E5%BC%8F/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-01-16T19:50:00+08:00" />
<meta property="article:modified_time" content="2023-01-16T19:50:00+08:00" /><meta property="og:site_name" content="fran6k" />





  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "post",
        "name": "设计模式2-创造型模式及应用",
        "headline": "设计模式2-创造型模式及应用",
        "alternativeHeadline": "",
        "description": "
      
        


      


    ",
        "inLanguage": "zh-cn",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/fran6k.live\/post\/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%88%9B%E9%80%A0%E5%9E%8B%E6%A8%A1%E5%BC%8F\/"
        },
        "author" : {
            "@type": "Person",
            "name": "fran6k\u0027s blog"
        },
        "creator" : {
            "@type": "Person",
            "name": "fran6k\u0027s blog"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "fran6k\u0027s blog"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "fran6k\u0027s blog"
        },
        "copyrightYear" : "2023",
        "dateCreated": "2023-01-16T19:50:00.00Z",
        "datePublished": "2023-01-16T19:50:00.00Z",
        "dateModified": "2023-01-16T19:50:00.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "fran6k's blog",
            "url": "https://fran6k.live",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/fran6k.live\/favicons\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
      ]

    ,
        "url" : "https:\/\/fran6k.live\/post\/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%88%9B%E9%80%A0%E5%9E%8B%E6%A8%A1%E5%BC%8F\/",
        "wordCount" : "538",
        "genre" : [ 
      
      "技术"

    ],
        "keywords" : [ ]
    }
  </script>


</head>
<body class="body">
    <div class="wrapper">








        
        <aside class="wrapper__sidebar"><div class="sidebar__toc">
    <h3>目录</h3>

    <nav id="TableOfContents">
  <ul>
    <li><a href="#简单工厂模式">简单工厂模式</a></li>
    <li><a href="#工厂方法模式">工厂方法模式</a></li>
    <li><a href="#抽象工厂方法模式">抽象工厂方法模式</a></li>
    <li><a href="#单例模式">单例模式</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>


</div></aside>
        

      <main
        
          class="wrapper__main sidebar__line"
        
      >
        <header class="header"><div
  class="
    animated fadeInDown
  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
        
        
          <li class="nav__list-item">
            <a
              
              href="/"
              
              title=""
              >主页</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            <a
              
              href="/post/"
              
              title=""
              >文章</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            <a
              
              href="/about/"
              
              title=""
              >关于</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            <a
              
              href="/friend-link/"
              
              title=""
              >友情链接</a
            >
          </li>
        

      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
        <li class="nav__list-item">
          <div class="themeswitch">
            <a title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </div>
        </li>
      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown
    "
  >
    
    <div class="post__content">
      <h1>设计模式2-创造型模式及应用</h1>
      
        <ul class="post__meta">
          <li class="post__meta-item">
            <em class="fas fa-calendar-day post__meta-icon"></em>
            <span class="post__meta-text"
              >
                
                  2023年1月16日 19:50
                

              
            </span>
          </li>
          <li class="post__meta-item">
            <em class="fas fa-stopwatch post__meta-icon"></em>
            <span class="post__meta-text">阅读时间 3 分钟</span>
          </li>
        </ul>
      




      <p>本文中代码案例简化自我的个人项目LightCD。LightCD是基于k8s的轻量级cicd系统，工作模式为master&amp;slave模式，slave构建镜像引擎为img(buildkit)和docker。</p>
<table>
<thead>
<tr>
<th style="text-align:center">模式名称</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">简单工厂模式</td>
<td style="text-align:center">专门定义一个类来创建其他类的实例。</td>
</tr>
<tr>
<td style="text-align:center">工厂模式</td>
<td style="text-align:center">定义一个工厂接口，每个类有自己的类工厂，类工厂实现工厂接口。将创建实例类的功能下放到类工厂中。</td>
</tr>
<tr>
<td style="text-align:center">抽象工厂模式</td>
<td style="text-align:center">提供一个创建一系列相关或者相互依赖的接口，而无需指定它们具体的类。</td>
</tr>
<tr>
<td style="text-align:center">单例模式</td>
<td style="text-align:center">是保证一个类仅有一个实例，并提供一个访问它的全局访问点。</td>
</tr>
</tbody>
</table>
<h2 id="简单工厂模式">简单工厂模式</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// -----抽象层-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// 构建引擎接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Push</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Clean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----实现层-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// Docker引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">EDocker</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">EDocker</span><span class="p">)</span><span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">EDocker</span><span class="p">)</span><span class="nf">Push</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">EDocker</span><span class="p">)</span><span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Img引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">EImg</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">EImg</span><span class="p">)</span><span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">EImg</span><span class="p">)</span><span class="nf">Push</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">EImg</span><span class="p">)</span><span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----工厂模块-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// 简单工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">SimpleFactory</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 创造引擎
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SimpleFactory</span><span class="p">)</span> <span class="nf">NewEngine</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">Engine</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&#34;docker&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">EDocker</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&#34;img&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">EImg</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">EDocker</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----业务逻辑层-----
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 初始化一个工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">f</span> <span class="o">:=</span> <span class="nx">SimpleFactory</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 工厂造引擎
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">engine</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">NewEngine</span><span class="p">(</span><span class="s">&#34;img&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 拿到引擎
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">engine</span><span class="p">.</span><span class="nf">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>	
</span></span></code></pre></div><p>简单工厂模式实现了对象创建和使用的分离，面向抽象接口编程，但是对工厂类职责过重，每新增一个产品实现，就要修改工厂类的代码，违反了开闭原则。随着产品越来越多，工厂类越来越复杂，所以工厂类适用于产品较少，不会造成工厂方法中的业务逻辑太复杂。</p>
<h2 id="工厂方法模式">工厂方法模式</h2>
<p>一个产品拥有一个工厂，如下图所示</p>
<p>水果（抽象接口） -&gt; 苹果，香蕉等</p>
<p>工厂 （抽象接口）-&gt; 苹果工厂，香蕉工厂等。</p>
<p><img src="https://redis.fran6k.live:1181/i/2023/01/16/63c52d72eeff6.png" alt="image-20230116185643027"></p>
<p><strong>实际案例：</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Push</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Clean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AbstractFactory</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">CreateEngine</span><span class="p">()</span> <span class="nx">Engine</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----实现层-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// Docker引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">EDocker</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">EDocker</span><span class="p">)</span> <span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">EDocker</span><span class="p">)</span> <span class="nf">Push</span><span class="p">()</span>  <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">EDocker</span><span class="p">)</span> <span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Img引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">EImg</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">EImg</span><span class="p">)</span> <span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">EImg</span><span class="p">)</span> <span class="nf">Push</span><span class="p">()</span>  <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">EImg</span><span class="p">)</span> <span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----工厂模块-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// Docker引擎工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">EDockerFactory</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 实现抽象工厂接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">EDockerFactory</span><span class="p">)</span> <span class="nf">CreateEngine</span><span class="p">()</span> <span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">EDocker</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Img引擎工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">EImgFactory</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 实现抽象工厂接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">EImgFactory</span><span class="p">)</span> <span class="nf">CreateEngine</span><span class="p">()</span> <span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">EImg</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----业务逻辑层-----
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 初始化抽象工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">DockerFac</span> <span class="nx">AbstractFactory</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 选择一个工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">DockerFac</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">EDockerFactory</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">d</span> <span class="o">:=</span> <span class="nx">DockerFac</span><span class="p">.</span><span class="nf">CreateEngine</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">d</span><span class="p">.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">ImgFac</span> <span class="nx">AbstractFactory</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 选择一个工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ImgFac</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">EImgFactory</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nx">ImgFac</span><span class="p">.</span><span class="nf">CreateEngine</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span><span class="p">.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>工厂方法模式，在编写代码中，不需要记住具体类名，只需要面对抽象接口编程。实现了对象创建和使用的分离，系统的可拓展性好，无需修改接口和原类。符合开闭原则。</p>
<p>但是增加了系统中类的个数，增加了系统的抽象性和理解难度。</p>
<h2 id="抽象工厂方法模式">抽象工厂方法模式</h2>
<p>抽象工厂模式在工厂模式的基础上，对工厂进一步抽象。</p>
<p>首先了解一个概念，产品等级结构和产品族。</p>
<p>产品族：水平区分，同类产品</p>
<p>产品等级结构：垂直区分，具有不同特点的同类产品。</p>
<p><img src="https://redis.fran6k.live:1181/i/2023/01/16/63c52fd4171fe.png" alt="image-20230116190644156a"></p>
<p>工厂 -&gt; 中国工厂，美国工厂等。</p>
<p>苹果 -&gt; 中国苹果，美国苹果等。</p>
<p>梨 -&gt; 中国梨，美国梨等。</p>
<p><img src="https://redis.fran6k.live:1181/i/2023/01/16/63c533e60657e.png" alt="image-20230116192419001"></p>
<p><strong>实际案例：</strong></p>
<p>这里产品族是Img引擎，Docker引擎。产品等级结构是测试版本，公开版本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----抽象层-----
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">AbstractEDocker</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Push</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Clean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AbstractEImg</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Push</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Clean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AbstractFactory</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">CreateDockerEngine</span><span class="p">()</span> <span class="nx">AbstractEDocker</span>
</span></span><span class="line"><span class="cl">	<span class="nf">CreateImgEngine</span><span class="p">()</span> <span class="nx">AbstractEImg</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----实现层-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// test版本Docker引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">TestEDocker</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">TestEDocker</span><span class="p">)</span> <span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">TestEDocker</span><span class="p">)</span> <span class="nf">Push</span><span class="p">()</span>  <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">TestEDocker</span><span class="p">)</span> <span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// test版本Img引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">TestEImg</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">TestEImg</span><span class="p">)</span> <span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">TestEImg</span><span class="p">)</span> <span class="nf">Push</span><span class="p">()</span>  <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">TestEImg</span><span class="p">)</span> <span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----工厂模块-----
</span></span></span><span class="line"><span class="cl"><span class="c1">// test版本工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">TestVersionFactory</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">TestVersionFactory</span><span class="p">)</span> <span class="nf">CreateDockerEngine</span><span class="p">()</span> <span class="nx">AbstractEDocker</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">TestEDocker</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">TestVersionFactory</span><span class="p">)</span> <span class="nf">CreateImgEngine</span><span class="p">()</span> <span class="nx">AbstractEImg</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">TestEImg</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// release版本Docker引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ReleaseEDocker</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">ReleaseEDocker</span><span class="p">)</span> <span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">ReleaseEDocker</span><span class="p">)</span> <span class="nf">Push</span><span class="p">()</span>  <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">ReleaseEDocker</span><span class="p">)</span> <span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// test版本Img引擎，实现Engine接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ReleaseEImg</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">ReleaseEImg</span><span class="p">)</span> <span class="nf">Build</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">ReleaseEImg</span><span class="p">)</span> <span class="nf">Push</span><span class="p">()</span>  <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">i</span> <span class="o">*</span><span class="nx">ReleaseEImg</span><span class="p">)</span> <span class="nf">Clean</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// release版本工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ReleaseVersionFactory</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">ReleaseVersionFactory</span><span class="p">)</span> <span class="nf">CreateDockerEngine</span><span class="p">()</span> <span class="nx">AbstractEDocker</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">ReleaseEDocker</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">ReleaseVersionFactory</span><span class="p">)</span> <span class="nf">CreateImgEngine</span><span class="p">()</span> <span class="nx">AbstractEImg</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">ReleaseEImg</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----业务逻辑层-----
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 初始化抽象工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">Fac</span> <span class="nx">AbstractFactory</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 创建测试版本的工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Fac</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">TestVersionFactory</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 创建一个测试版本的Img引擎
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ti</span> <span class="o">:=</span> <span class="nx">Fac</span><span class="p">.</span><span class="nf">CreateImgEngine</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ti</span><span class="p">.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 创建一个测试版本的docker引擎
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">td</span> <span class="o">:=</span> <span class="nx">Fac</span><span class="p">.</span><span class="nf">CreateDockerEngine</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">td</span><span class="p">.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 创建公开版本的工厂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Fac</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">ReleaseVersionFactory</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ri</span> <span class="o">:=</span> <span class="nx">Fac</span><span class="p">.</span><span class="nf">CreateImgEngine</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ri</span><span class="p">.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">rd</span> <span class="o">:=</span> <span class="nx">Fac</span><span class="p">.</span><span class="nf">CreateDockerEngine</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rd</span><span class="p">.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>抽象工厂模式拥有工厂模式的优点，增加产品族（水平拓展）很方便，无需修改已有代码。</p>
<p>但是也有缺点。首先是系统复杂度增加，由“一纬“到”二维“。增加产品等级结构时，需要对原有系统进行较大改动，比如上述例子中，当我再增加一个Stage版本时，需要再增加两个实现类StageImg和StageDocker，这些实现类需要实现各自的接口，除此外，还需要增加一个Stage版本工厂实现类，实现自己的接口。显然带来较大的不便，违背了“开闭原则”。</p>
<h2 id="单例模式">单例模式</h2>
<p>单例模式较为简单，这里直接贴代码例子</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">三个要点：
</span></span></span><span class="line"><span class="cl"><span class="cm">		一是某个类只能有一个实例；
</span></span></span><span class="line"><span class="cl"><span class="cm">		二是它必须自行创建这个实例；
</span></span></span><span class="line"><span class="cl"><span class="cm">		三是它必须自行向整个系统提供这个实例。
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">	保证一个类永远只能有一个对象
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//1、保证这个类非公有化，外界不能通过这个类直接创建一个对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//   那么这个类就应该变得非公有访问 类名称首字母要小写
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">singelton</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//2、但是还要有一个指针可以指向这个唯一对象，但是这个指针永远不能改变方向
</span></span></span><span class="line"><span class="cl"><span class="c1">//   Golang中没有常指针概念，所以只能通过将这个指针私有化不让外部模块访问
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">instance</span> <span class="o">*</span><span class="nx">singelton</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">singelton</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//3、如果全部为私有化，那么外部模块将永远无法访问到这个类和对象，
</span></span></span><span class="line"><span class="cl"><span class="c1">//   所以需要对外提供一个方法来获取这个唯一实例对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//   注意：这个方法是否可以定义为singelton的一个成员方法呢？
</span></span></span><span class="line"><span class="cl"><span class="c1">//       答案是不能，因为如果为成员方法就必须要先访问对象、再访问函数
</span></span></span><span class="line"><span class="cl"><span class="c1">//        但是类和对象目前都已经私有化，外界无法访问，所以这个方法一定是一个全局普通函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GetInstance</span><span class="p">()</span> <span class="o">*</span><span class="nx">singelton</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">instance</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">singelton</span><span class="p">)</span> <span class="nf">SomeThing</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;单例对象的某方法&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span> <span class="o">:=</span> <span class="nf">GetInstance</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">SomeThing</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>单例模式提供了对唯一实例的受控访问，节约系统资源，结构清晰明了，简单易懂。但是因为单例模式没有抽象依赖，所以拓展性较差，除此外也有并发安全的问题。</p>
<h2 id="总结">总结</h2>
<p>单例模式，简单工厂，工厂，抽象工厂四个模式中，抽象程度和系统复杂度越来越高，耦合度越来越低，开发者应该根据实际情况选择满足当下系统需求的创造者模式，不能一味追求低耦合度而使得系统庞大复杂，过度设计，不利于系统的维护。</p>


<h3>这个系列的帖子</h3>
<ul>
  
    <li><a href="/post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F3-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/">设计模式3-结构型模式</a></li>
  
    <li><a href="/post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2-%E5%88%9B%E9%80%A0%E5%9E%8B%E6%A8%A1%E5%BC%8F/">设计模式2-创造型模式及应用</a></li>
  
    <li><a href="/post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F1-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/">设计模式1-设计原则</a></li>
  
</ul>
</div>
    <div class="post__footer">
      
        <span><a class="category" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span>


      

      
    </div>

    
  </div>

      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        2024
      
    </li>
    
      <li class="footer__item">
        <a
          class="link"
          href="https://beian.miit.gov.cn/#/Integrated/index"
          
            target="_blank" rel="noopener noreferrer"
          
          title=""
        >
          晋ICP备20007820号-1
        </a>
      </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></body>
</html>
